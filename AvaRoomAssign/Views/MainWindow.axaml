<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AvaRoomAssign.ViewModels"
        xmlns:models="using:AvaRoomAssign.Models"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="950"
        x:Class="AvaRoomAssign.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/house.ico"
        Title="抢房好好好 - Avalonia版 Ver 2.2.0 By: hp"
        Width="800" Height="700"
        MinWidth="750" MinHeight="550"
        WindowStartupLocation="CenterScreen"
        CanResize="true">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Resources>
        <models:BoolToInverseBoolConverter x:Key="BoolToInverseConverter"/>
        <models:IntToBoolConverter x:Key="IntToBoolConverter"/>
        <models:MultiBoolConverter x:Key="MultiBoolConverter"/>
        <models:BoolToTextConverter x:Key="BoolToTextConverter" TrueText="手动房源ID" FalseText="社区条件设置"/>
        <models:HouseTypeConverter x:Key="HouseTypeConverter"/>
        <models:RoomCountConverter x:Key="RoomCountConverter"/>
        <models:ConditionCountConverter x:Key="ConditionCountConverter"/>
        <models:FloorRangeConverter x:Key="FloorRangeConverter"/>
        <models:UpdateTimeConverter x:Key="UpdateTimeConverter"/>
        <models:IntGreaterThanZeroConverter x:Key="IntGreaterThanZeroConverter"/>
        <models:BoolToTextConverter x:Key="FetchingCookieTextConverter" TrueText="🔄 获取中..." FalseText="🔑 自动获取"/>
        
        <!-- 浅色主题资源 - 现代清新配色 -->
        <SolidColorBrush x:Key="ThemeBackground" Color="#F7F9FC"/>
        <SolidColorBrush x:Key="ThemeCardBackground" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="ThemeTextPrimary" Color="#1A202C"/>
        <SolidColorBrush x:Key="ThemeTextSecondary" Color="#718096"/>
        <SolidColorBrush x:Key="ThemeBorder" Color="#E2E8F0"/>
        <SolidColorBrush x:Key="ThemeAccent" Color="#4299E1"/>
        <SolidColorBrush x:Key="ThemeAccentHover" Color="#3182CE"/>
        <SolidColorBrush x:Key="ThemeSuccess" Color="#48BB78"/>
        <SolidColorBrush x:Key="ThemeWarning" Color="#ED8936"/>
        <SolidColorBrush x:Key="ThemeDanger" Color="#F56565"/>
        <SolidColorBrush x:Key="ThemeLogBackground" Color="#F7FAFC"/>
        <SolidColorBrush x:Key="ThemeLogText" Color="#38A169"/>
        <!-- 表格相关颜色 -->
        <SolidColorBrush x:Key="ThemeTableAlternating" Color="#F7FAFC"/>
        <SolidColorBrush x:Key="ThemeTableHover" Color="#EBF8FF"/>
        <SolidColorBrush x:Key="ThemeTableSelected" Color="#BEE3F8"/>
        
        <!-- 深色主题资源 - 深邃现代配色 -->
        <SolidColorBrush x:Key="DarkThemeBackground" Color="#0F1419"/>
        <SolidColorBrush x:Key="DarkThemeCardBackground" Color="#1A202C"/>
        <SolidColorBrush x:Key="DarkThemeTextPrimary" Color="#F7FAFC"/>
        <SolidColorBrush x:Key="DarkThemeTextSecondary" Color="#A0AEC0"/>
        <SolidColorBrush x:Key="DarkThemeBorder" Color="#2D3748"/>
        <SolidColorBrush x:Key="DarkThemeAccent" Color="#63B3ED"/>
        <SolidColorBrush x:Key="DarkThemeAccentHover" Color="#90CDF4"/>
        <SolidColorBrush x:Key="DarkThemeSuccess" Color="#68D391"/>
        <SolidColorBrush x:Key="DarkThemeWarning" Color="#F6AD55"/>
        <SolidColorBrush x:Key="DarkThemeDanger" Color="#FC8181"/>
        <SolidColorBrush x:Key="DarkThemeLogBackground" Color="#171923"/>
        <SolidColorBrush x:Key="DarkThemeLogText" Color="#9AE6B4"/>
        <!-- 深色主题表格相关颜色 -->
        <SolidColorBrush x:Key="DarkThemeTableAlternating" Color="#2D3748"/>
        <SolidColorBrush x:Key="DarkThemeTableHover" Color="#4A5568"/>
        <SolidColorBrush x:Key="DarkThemeTableSelected" Color="#3182CE"/>
    </Window.Resources>

    <Window.Styles>
        <!-- 卡片样式 -->
        <Style Selector="Border.modern-card">
            <Setter Property="Background" Value="{DynamicResource ThemeCardBackground}"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#10000000" OffsetX="0" OffsetY="4" BlurRadius="20"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 可折叠卡片样式 -->
        <Style Selector="Border.collapsible-card">
            <Setter Property="Background" Value="{DynamicResource ThemeCardBackground}"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#08000000" OffsetX="0" OffsetY="2" BlurRadius="12"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 折叠面板头部样式 -->
        <Style Selector="Button.collapse-header">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="CornerRadius" Value="16,16,0,0"/>
            <Setter Property="Padding" Value="24,20"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>

        <Style Selector="Button.collapse-header:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeTableHover}"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style Selector="Button.collapse-header:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeTableSelected}"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- 主要按钮样式 - 使用主题色 -->
        <Style Selector="Button.modern-primary">
            <Setter Property="Background" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20,14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#40000000" OffsetX="0" OffsetY="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Button.modern-primary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeAccentHover}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,14"/>
        </Style>

        <Style Selector="Button.modern-primary:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeAccentHover}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,14"/>
            <Setter Property="Opacity" Value="0.8"/>
        </Style>

        <Style Selector="Button.modern-primary:disabled /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextSecondary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,14"/>
        </Style>

        <!-- 次要按钮样式 -->
        <Style Selector="Button.modern-secondary">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20,14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
        </Style>

        <Style Selector="Button.modern-secondary:pointerover">
            <Setter Property="Background" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="Padding" Value="20,14"/>
        </Style>

        <!-- 危险按钮样式 -->
        <Style Selector="Button.modern-danger">
            <Setter Property="Background" Value="{DynamicResource ThemeDanger}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style Selector="Button.modern-danger:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeDanger}"/>
            <Setter Property="Opacity" Value="0.8"/>
        </Style>

        <!-- 主题切换按钮 -->
        <Style Selector="Button.theme-toggle">
            <Setter Property="Background" Value="{DynamicResource ThemeWarning}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="24"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#40000000" OffsetX="0" OffsetY="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Button.theme-toggle:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeWarning}"/>
            <Setter Property="Opacity" Value="0.8"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- 工具按钮样式 (GitHub, 配置文件夹等) -->
        <Style Selector="Button.tool-icon">
            <Setter Property="Background" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeCardBackground}"/>
            <Setter Property="CornerRadius" Value="24"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#40000000" OffsetX="0" OffsetY="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Button.tool-icon:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeTextSecondary}"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- 配置文件夹按钮特殊样式 -->
        <Style Selector="Button.config-folder-icon">
            <Setter Property="Background" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="24"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#40000000" OffsetX="0" OffsetY="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Button.config-folder-icon:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource ThemeAccentHover}"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- 标签样式 -->
        <Style Selector="TextBlock.modern-label">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- 标题样式 -->
        <Style Selector="TextBlock.modern-title">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="28"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
        </Style>

        <!-- 副标题样式 -->
        <Style Selector="TextBlock.modern-subtitle">
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextSecondary}"/>
        </Style>

        <!-- 日志文本框样式 -->
        <Style Selector="TextBox.modern-log">
            <Setter Property="Background" Value="{DynamicResource ThemeLogBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeLogText}"/>
            <Setter Property="FontFamily" Value="Consolas, 'SF Mono', 'Monaco', 'Menlo', monospace"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeSuccess}"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="MinHeight" Value="60"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Top"/>
        </Style>

        <!-- DataGrid样式 - 现代化设计 -->
        <Style Selector="DataGrid.modern">
            <Setter Property="Background" Value="{DynamicResource ThemeCardBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="RowBackground" Value="Transparent"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="CanUserReorderColumns" Value="False"/>
            <Setter Property="CanUserSortColumns" Value="False"/>
            <Setter Property="CanUserResizeColumns" Value="False"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="RowHeight" Value="48"/>
        </Style>

        <!-- DataGrid Header样式 -->
        <Style Selector="DataGrid.modern DataGridColumnHeader">
            <Setter Property="Background" Value="{DynamicResource ThemeTableAlternating}"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Border Background="{DynamicResource ThemeTableAlternating}"
                                BorderBrush="{DynamicResource ThemeBorder}"
                                BorderThickness="0,0,1,1"
                                CornerRadius="{TemplateBinding CornerRadius}">
                            <ContentPresenter Content="{TemplateBinding Content}"
                                              ContentTemplate="{TemplateBinding ContentTemplate}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              Margin="12,14"
                                              TextBlock.Foreground="{DynamicResource ThemeTextPrimary}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 第一个表头的圆角 -->
        <Style Selector="DataGrid.modern DataGridColumnHeader:nth-child(1)">
            <Setter Property="CornerRadius" Value="12,0,0,0"/>
        </Style>

        <!-- 最后一个表头的圆角 -->
        <Style Selector="DataGrid.modern DataGridColumnHeader:last-child">
            <Setter Property="CornerRadius" Value="0,12,0,0"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>

        <!-- DataGrid Row样式 -->
        <Style Selector="DataGrid.modern DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="MinHeight" Value="48"/>
        </Style>

        <!-- DataGrid 交替行背景 -->
        <Style Selector="DataGrid.modern DataGridRow:nth-child(even)">
            <Setter Property="Background" Value="{DynamicResource ThemeTableAlternating}"/>
        </Style>

        <!-- DataGrid 悬停效果 -->
        <Style Selector="DataGrid.modern DataGridRow:pointerover">
            <Setter Property="Background" Value="{DynamicResource ThemeTableHover}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <!-- DataGrid 选中效果 -->
        <Style Selector="DataGrid.modern DataGridRow:selected">
            <Setter Property="Background" Value="{DynamicResource ThemeTableSelected}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <!-- DataGrid 选中且悬停 -->
        <Style Selector="DataGrid.modern DataGridRow:selected:pointerover">
            <Setter Property="Background" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <!-- DataGrid Cell样式 -->
        <Style Selector="DataGrid.modern DataGridCell">
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
        
        <!-- DataGrid Cell内的TextBlock样式 -->
        <Style Selector="DataGrid.modern DataGridCell TextBlock">
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
            <Setter Property="ToolTip.Tip" Value="{Binding Text, RelativeSource={RelativeSource Self}}"/>
        </Style>

        <!-- 信息图标样式 - 使用主题色 -->
        <Style Selector="Border.info-icon">
            <Setter Property="Background" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#40000000" OffsetX="0" OffsetY="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Border.warning-icon">
            <Setter Property="Background" Value="{DynamicResource ThemeWarning}"/>
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#40000000" OffsetX="0" OffsetY="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Border.success-icon">
            <Setter Property="Background" Value="{DynamicResource ThemeSuccess}"/>
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#40000000" OffsetX="0" OffsetY="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Border.danger-icon">
            <Setter Property="Background" Value="{DynamicResource ThemeDanger}"/>
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#40000000" OffsetX="0" OffsetY="2" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 输入框样式 -->
        <Style Selector="TextBox">
            <Setter Property="Background" Value="{DynamicResource ThemeCardBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>

        <!-- 下拉框样式 -->
        <Style Selector="ComboBox">
            <Setter Property="Background" Value="{DynamicResource ThemeCardBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style Selector="ComboBox:focus /template/ Border#Background">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
        </Style>

        <!-- DataGrid中的ComboBox样式 -->
        <Style Selector="DataGrid.modern ComboBox">
            <Setter Property="Background" Value="{DynamicResource ThemeCardBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="MinHeight" Value="32"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style Selector="DataGrid.modern ComboBox:focus /template/ Border#Background">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style Selector="DataGrid.modern ComboBox:pointerover /template/ Border#Background">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource ThemeTableHover}"/>
        </Style>

        <!-- 复选框样式 - 使用更通用的方法 -->
        <Style Selector="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Border Name="PART_Border"
                                    Width="20" Height="20"
                                    Background="{DynamicResource ThemeCardBackground}"
                                    BorderBrush="{DynamicResource ThemeAccent}"
                                    BorderThickness="2"
                                    CornerRadius="4">
                                <Path Name="PART_CheckMark"
                                      Width="12" Height="12"
                                      Data="M 0 6 L 4 10 L 12 2"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      IsVisible="False"/>
                            </Border>
                            <ContentPresenter Content="{TemplateBinding Content}"
                                              VerticalAlignment="Center"/>
                        </StackPanel>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="CheckBox:checked /template/ Border#PART_Border">
            <Setter Property="Background" Value="{DynamicResource ThemeAccent}"/>
        </Style>

        <Style Selector="CheckBox:checked /template/ Path#PART_CheckMark">
            <Setter Property="IsVisible" Value="True"/>
        </Style>

        <Style Selector="CheckBox:pointerover /template/ Border#PART_Border">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccentHover}"/>
        </Style>

        <!-- ToggleSwitch 直接描边样式 -->
        <Style Selector="ToggleSwitch">
            <Setter Property="Foreground" Value="{DynamicResource ThemeTextPrimary}"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <!-- ToggleSwitch Off状态（默认状态）的蓝色边框 -->
        <Style Selector="ToggleSwitch:not(:checked) /template/ Border">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <!-- ToggleSwitch On状态的蓝色边框，但背景保持原色 -->
        <Style Selector="ToggleSwitch:checked /template/ Border">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <!-- 备用选择器 - 针对所有状态，确保背景不变蓝 -->
        <Style Selector="ToggleSwitch /template/ Border#PART_SwitchTrack">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <Style Selector="ToggleSwitch /template/ Border#SwitchKnobBounds">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <!-- 确保checked状态下轨道背景保持灰色 -->
        <Style Selector="ToggleSwitch:checked /template/ Border#PART_SwitchTrack">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <Style Selector="ToggleSwitch:checked /template/ Border#SwitchKnobBounds">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <!-- 强制所有Border都使用蓝色边框，但背景保持灰色 -->
        <Style Selector="ToggleSwitch /template/ Border">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccent}" />
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="{DynamicResource ThemeBorder}"/>
        </Style>

        <!-- 悬停时也保持蓝色 -->
        <Style Selector="ToggleSwitch:pointerover /template/ Border">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeAccentHover}"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>

        <!-- ToggleSwitch 滑块颜色设置 -->
        <Style Selector="ToggleSwitch /template/ Ellipse">
            <Setter Property="Fill" Value="{DynamicResource ThemeAccent}"/>
        </Style>

        <Style Selector="ToggleSwitch /template/ Ellipse#PART_SwitchKnob">
            <Setter Property="Fill" Value="{DynamicResource ThemeAccent}"/>
        </Style>

        <Style Selector="ToggleSwitch /template/ Border#PART_SwitchKnob">
            <Setter Property="Background" Value="{DynamicResource ThemeAccent}"/>
        </Style>

        <!-- 确保不同状态下滑块都是蓝色 -->
        <Style Selector="ToggleSwitch:checked /template/ Ellipse">
            <Setter Property="Fill" Value="{DynamicResource ThemeAccent}"/>
        </Style>

        <Style Selector="ToggleSwitch:not(:checked) /template/ Ellipse">
            <Setter Property="Fill" Value="{DynamicResource ThemeAccent}"/>
        </Style>
    </Window.Styles>

    <Grid Background="{DynamicResource ThemeBackground}" x:Name="MainGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 顶部标题栏和工具栏 - 增加渐变背景 -->
        <Border Grid.Row="0" 
                BorderBrush="{DynamicResource ThemeBorder}" 
                BorderThickness="0,0,0,1"
                Padding="20,20"
                x:Name="HeaderBorder">
            <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                    <GradientStop Color="#FFFFFF" Offset="0"/>
                    <GradientStop Color="#F8F9FA" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Spacing="8">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBlock Classes="modern-title" Text="🏠" FontSize="32"/>
                        <TextBlock Classes="modern-title" Text="抢房好好好"/>
                    </StackPanel>
                    <TextBlock Classes="modern-subtitle" Text="Ver 2.2.0 - 自动化抢公租房/人才公寓，祝大家抢房顺利！"/>
                </StackPanel>

                <!-- 工具栏区域 -->
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal" 
                            Spacing="12" 
                            VerticalAlignment="Center"
                            x:Name="ToolbarPanel">
                    
                    <!-- 配置文件夹按钮 -->
                    <Button Classes="config-folder-icon"
                            Content="📁"
                            ToolTip.Tip="打开配置文件夹"
                            Command="{Binding OpenConfigFolderCommand}"/>
                    
                    <!-- GitHub按钮 -->
                    <Button Classes="tool-icon"
                            Content="G"
                            ToolTip.Tip="访问GitHub仓库"
                            Command="{Binding OpenGitHubCommand}"/>
                    
                    <!-- 主题切换按钮 -->
                    <Button Classes="theme-toggle"
                        Content="🌙"
                        ToolTip.Tip="切换主题"
                        Click="OnThemeToggleClick"
                        x:Name="ThemeToggleButton"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 可滚动的配置区域 -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="12,12,12,0"
                      x:Name="ConfigScrollViewer">
            <!-- 响应式容器 -->
            <Panel x:Name="ResponsiveContainer">
                <!-- 单列布局 (默认, 窗口宽度 < 1200px) -->
                <StackPanel x:Name="SingleColumnLayout" 
                           HorizontalAlignment="Stretch" 
                           Margin="0,0,0,0">
                    
                    <!-- 运行模式配置 -->
                    <Border Classes="collapsible-card" HorizontalAlignment="Stretch">
                        <Grid RowDefinitions="Auto,Auto">
                            <Button Grid.Row="0" 
                                    Classes="collapse-header"
                                    Click="OnOperationModeToggle"
                                    x:Name="OperationModeToggleSingle">
                                <StackPanel Orientation="Horizontal" Spacing="16">
                                    <TextBlock Text="🚀" FontSize="20" VerticalAlignment="Center"/>
                                    <TextBlock Text="运行模式配置" VerticalAlignment="Center"/>
                                    <TextBlock Text="▼" 
                                               x:Name="OperationModeIconSingle"
                                               FontSize="14" 
                                               VerticalAlignment="Center" 
                                               Foreground="{DynamicResource ThemeTextSecondary}"/>
                                </StackPanel>
                            </Button>

                            <StackPanel Grid.Row="1" 
                                        x:Name="OperationModeContentSingle"
                                        Spacing="20" 
                                        Margin="24,0,24,24">
                                <Grid ColumnDefinitions="*,*,Auto" HorizontalAlignment="Stretch">
                                    <StackPanel Grid.Column="0" Spacing="8" HorizontalAlignment="Stretch">
                                        <TextBlock Classes="modern-label" Text="运行模式"/>
                                        <ComboBox SelectedIndex="{Binding SelectedOperationMode}"
                                                  ItemsSource="{Binding OperationModes}"
                                                  IsEnabled="{Binding !IsRunning}"
                                                  HorizontalAlignment="Stretch"
                                                  ToolTip.Tip="模拟点击模式可以看到具体的操作，在最后一步确认需要手动点击，成功率较高，但是速度较发包模式慢；发包模式理论速度最快，但是需要cookie，并且不保证成功率"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Spacing="8" Margin="24,0,0,0" HorizontalAlignment="Stretch">
                                        <TextBlock Classes="modern-label" Text="浏览器类型"/>
                                        <ComboBox SelectedIndex="{Binding SelectedBrowserType}"
                                                  ItemsSource="{Binding BrowserTypes}"
                                                  IsEnabled="{Binding !IsRunning}"
                                                  HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <Border Grid.Column="2" Classes="info-icon"
                                            Width="40" Height="40" 
                                            VerticalAlignment="Bottom"
                                            Margin="24,0,0,0"
                                            ToolTip.Tip="模拟点击模式可以看到具体的操作，在最后一步确认需要手动点击，成功率较高，但是速度较发包模式慢；发包模式理论速度最快，但是需要cookie，并且不保证成功率">
                                        <TextBlock Text="?"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   FontWeight="Bold"
                                                   FontSize="20"
                                                   Foreground="White"/>
                                    </Border>
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- 账户信息配置 -->
                    <Border Classes="collapsible-card" HorizontalAlignment="Stretch">
                        <Grid RowDefinitions="Auto,Auto">
                            <Button Grid.Row="0" 
                                    Classes="collapse-header"
                                    Click="OnAccountToggle"
                                    x:Name="AccountToggleSingle">
                                <StackPanel Orientation="Horizontal" Spacing="16">
                                    <TextBlock Text="👤" FontSize="20" VerticalAlignment="Center"/>
                                    <TextBlock Text="账户信息配置" VerticalAlignment="Center"/>
                                    <TextBlock Text="▶" 
                                               x:Name="AccountIconSingle"
                                               FontSize="14" 
                                               VerticalAlignment="Center" 
                                               Foreground="{DynamicResource ThemeTextSecondary}"/>
                                </StackPanel>
                            </Button>

                            <StackPanel Grid.Row="1" 
                                        x:Name="AccountContentSingle"
                                        Spacing="20" 
                                        Margin="24,0,24,24"
                                        IsVisible="False">
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto" 
                                      ColumnDefinitions="180,*,Auto"
                                      HorizontalAlignment="Stretch">
                                    <!-- 用户账号 -->
                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                               Classes="modern-label"
                                               Text="用户账号"
                                               VerticalAlignment="Center"
                                               Margin="0,0,24,0"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" 
                                             Text="{Binding UserAccount}"
                                             IsEnabled="{Binding !IsRunning}"
                                             Watermark="请输入用户账号"
                                             Margin="0,0,24,16"
                                             HorizontalAlignment="Stretch"/>

                                    <!-- 用户密码 -->
                                    <TextBlock Grid.Row="1" Grid.Column="0" 
                                               Classes="modern-label"
                                               Text="用户密码"
                                               VerticalAlignment="Center"
                                               Margin="0,0,24,0"/>
                                    <TextBox Grid.Row="1" Grid.Column="1" 
                                             Text="{Binding UserPassword}"
                                             IsEnabled="{Binding !IsRunning}"
                                             PasswordChar="●"
                                             Watermark="请输入用户密码"
                                             Margin="0,0,24,16"
                                             HorizontalAlignment="Stretch"/>

                                                                            <!-- Cookie -->
                                        <TextBlock Grid.Row="2" Grid.Column="0" 
                                                   Classes="modern-label"
                                                   Text="Cookie"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,24,0"/>
                                        <Grid Grid.Row="2" Grid.Column="1" 
                                              ColumnDefinitions="*,Auto"
                                              Margin="0,0,24,16">
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding Cookie}"
                                                     IsEnabled="{Binding !IsRunning}"
                                                     Watermark="请输入Cookie(Http发包模式必填)"
                                                     Margin="0,0,8,0"/>
                                            <Button Grid.Column="1"
                                                    Classes="modern-secondary" 
                                                    Content="{Binding IsFetchingCookie, Converter={StaticResource FetchingCookieTextConverter}}" 
                                                    Command="{Binding FetchCookieCommand}"
                                                    FontSize="12"
                                                    Padding="8,6"
                                                    ToolTip.Tip="通过用户名和密码自动获取Cookie">
                                                <Button.IsEnabled>
                                                    <MultiBinding Converter="{StaticResource MultiBoolConverter}">
                                                        <Binding Path="!IsRunning"/>
                                                        <Binding Path="!IsFetchingCookie"/>
                                                    </MultiBinding>
                                                </Button.IsEnabled>
                                            </Button>
                                        </Grid>
                                        <Border Grid.Row="2" Grid.Column="2" 
                                                Classes="warning-icon"
                                                Width="36" Height="36" 
                                                VerticalAlignment="Center"
                                                ToolTip.Tip="填写了cookie后就不用填账号密码了。点击『自动获取』按钮可以通过账号密码自动获取Cookie">
                                            <TextBlock Text="?"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontWeight="Bold"
                                                       FontSize="18"
                                                       Foreground="White"/>
                                        </Border>

                                    <!-- 申请人姓名 -->
                                    <TextBlock Grid.Row="3" Grid.Column="0" 
                                               Classes="modern-label"
                                               Text="申请人姓名"
                                               VerticalAlignment="Center"
                                               Margin="0,0,24,0"/>
                                    <TextBox Grid.Row="3" Grid.Column="1" 
                                             Text="{Binding ApplierName}"
                                             IsEnabled="{Binding !IsRunning}"
                                             Watermark="请输入申请人姓名"
                                             HorizontalAlignment="Stretch"/>
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- 执行参数配置 -->
                    <Border Classes="collapsible-card" HorizontalAlignment="Stretch">
                        <Grid RowDefinitions="Auto,Auto">
                            <Button Grid.Row="0" 
                                    Classes="collapse-header"
                                    Click="OnExecutionToggle"
                                    x:Name="ExecutionToggleSingle">
                                <StackPanel Orientation="Horizontal" Spacing="16">
                                    <TextBlock Text="⏰" FontSize="20" VerticalAlignment="Center"/>
                                    <TextBlock Text="执行参数配置" VerticalAlignment="Center"/>
                                    <TextBlock Text="▶" 
                                               x:Name="ExecutionIconSingle"
                                               FontSize="14" 
                                               VerticalAlignment="Center" 
                                               Foreground="{DynamicResource ThemeTextSecondary}"/>
                                </StackPanel>
                            </Button>

                            <StackPanel Grid.Row="1" 
                                        x:Name="ExecutionContentSingle"
                                        Spacing="16" 
                                        Margin="24,0,24,24"
                                        IsVisible="False">
                                <!-- 开始时间 -->
                                <StackPanel Spacing="8">
                                    <TextBlock Classes="modern-label" Text="开始时间"/>
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <CalendarDatePicker SelectedDate="{Binding StartDate}" Width="200" IsEnabled="{Binding !IsRunning}"/>
                                        <TextBox Text="{Binding StartHour}" Width="80" Watermark="时" IsEnabled="{Binding !IsRunning}"/>
                                        <TextBlock Text=":" VerticalAlignment="Center" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource ThemeTextPrimary}"/>
                                        <TextBox Text="{Binding StartMinute}" Width="80" Watermark="分" IsEnabled="{Binding !IsRunning}"/>
                                        <TextBlock Text=":" VerticalAlignment="Center" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource ThemeTextPrimary}"/>
                                        <TextBox Text="{Binding StartSecond}" Width="80" Watermark="秒" IsEnabled="{Binding !IsRunning}"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- 触发间隔和自动确认 -->
                                <Grid ColumnDefinitions="*,*" HorizontalAlignment="Stretch">
                                    <StackPanel Grid.Column="0" Spacing="8">
                                        <TextBlock Classes="modern-label" Text="触发间隔(ms)"/>
                                        <TextBox Text="{Binding ClickInterval}" 
                                                 IsEnabled="{Binding !IsRunning}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Spacing="8" Margin="24,0,0,0">
                                        <TextBlock Classes="modern-label" Text="自动确定最后一步"/>
                                        <StackPanel Orientation="Horizontal" Spacing="16">
                                            <CheckBox IsChecked="{Binding AutoConfirm}"
                                                      IsEnabled="{Binding !IsRunning}"
                                                      VerticalAlignment="Center"/>
                                            <Border Classes="danger-icon"
                                                    Width="32" Height="32" 
                                                    VerticalAlignment="Center"
                                                    ToolTip.Tip="慎重选择！如果选中，程序会自动点击最后一步抢房，如果不选中，程序会停在最后一步，需要手动点击确认">
                                                <TextBlock Text="!"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           FontWeight="Bold"
                                                           FontSize="18"
                                                           Foreground="White"/>
                                            </Border>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- 房源设置 (社区条件设置/手动房源ID) -->
                    <Border Classes="collapsible-card" HorizontalAlignment="Stretch">
                        <Grid RowDefinitions="Auto,Auto">
                            <!-- 面板标题行 -->
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Button Grid.Column="0" 
                                        Classes="collapse-header"
                                        Click="OnCommunityToggle"
                                        x:Name="CommunityToggleSingle"
                                        HorizontalAlignment="Stretch">
                                    <StackPanel Orientation="Horizontal" Spacing="16">
                                        <TextBlock Text="🏘️" FontSize="20" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding UseManualRoomIds, Converter={StaticResource BoolToTextConverter}}" VerticalAlignment="Center"/>
                                        <Border Classes="success-icon"
                                                Width="28" Height="28" 
                                                VerticalAlignment="Center"
                                                Margin="12,0,0,0"
                                                ToolTip.Tip="配置房源选择条件">
                                            <TextBlock Text="?"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontWeight="Bold"
                                                       FontSize="14"
                                                       Foreground="White"/>
                                        </Border>
                                        <TextBlock Text="▶" 
                                                   x:Name="CommunityIconSingle"
                                                   FontSize="14" 
                                                   VerticalAlignment="Center" 
                                                   Foreground="{DynamicResource ThemeTextSecondary}"/>
                                    </StackPanel>
                                </Button>
                                
                                <!-- 切换开关放在最右边 (仅在HTTP发包模式下显示) -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center" Margin="16,0">
                                    <StackPanel.IsVisible>
                                        <Binding Path="SelectedOperationMode" Converter="{StaticResource IntToBoolConverter}" ConverterParameter="1"/>
                                    </StackPanel.IsVisible>
                                    <TextBlock Text="社区条件" FontSize="12" VerticalAlignment="Center" Foreground="{DynamicResource ThemeTextSecondary}"/>
                                    <ToggleSwitch IsChecked="{Binding UseManualRoomIds}" 
                                                  IsEnabled="{Binding !IsRunning}"
                                                  OffContent=""
                                                  OnContent=""
                                                  ToolTip.Tip="切换房源设置模式：关闭=社区条件设置，开启=手动房源ID"/>
                                    <TextBlock Text="手动ID" FontSize="12" VerticalAlignment="Center" Foreground="{DynamicResource ThemeTextSecondary}"/>
                                </StackPanel>
                            </Grid>

                            <StackPanel Grid.Row="1" 
                                        x:Name="CommunityContentSingle"
                                        Spacing="20" 
                                        Margin="24,0,24,24"
                                        IsVisible="False">
                                
                                <!-- 社区条件设置内容 -->
                                <StackPanel IsVisible="{Binding !UseManualRoomIds}">
                                    <Button Classes="modern-primary" 
                                            Content="➕ 添加条件" 
                                            Command="{Binding AddCommunityCommand}" 
                                            IsEnabled="{Binding !IsRunning}"
                                            HorizontalAlignment="Left"/>

                                                                            <!-- 单列布局DataGrid -->
                                        <DataGrid Classes="modern"
                                                  ItemsSource="{Binding CommunityConditions}"
                                                  CanUserReorderColumns="False"
                                                  CanUserResizeColumns="False"
                                                  CanUserSortColumns="False"
                                                  GridLinesVisibility="None"
                                                  HeadersVisibility="Column"
                                                  MinHeight="100"
                                                  Background="Transparent"
                                                  BorderThickness="0"
                                                  CornerRadius="12"
                                                  AutoGenerateColumns="False"
                                                  IsEnabled="{Binding !IsRunning}"
                                                  Margin="0,8"
                                                  HorizontalAlignment="Stretch">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="小区名称" Binding="{Binding CommunityName}" Width="2*" CanUserSort="False"/>
                                                <DataGridTextColumn Header="幢号" Binding="{Binding BuildingNo}" Width="0.8*" CanUserSort="False"/>
                                                <DataGridTextColumn Header="层数" Binding="{Binding FloorRange}" Width="1*" CanUserSort="False"/>
                                                <DataGridTextColumn Header="价格" Binding="{Binding MaxPrice}" Width="1*" CanUserSort="False"/>
                                                <DataGridTextColumn Header="面积" Binding="{Binding LeastArea}" Width="1*" CanUserSort="False"/>
                                                <DataGridTemplateColumn Header="房型" Width="1*" CanUserSort="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <ComboBox SelectedItem="{Binding HouseTypeDescription}"
                                                                      ItemsSource="{Binding $parent[Window].DataContext.HouseTypes}"
                                                                      HorizontalAlignment="Stretch"
                                                                      Margin="4,2"
                                                                      FontSize="12"
                                                                      BorderThickness="1"
                                                                      Padding="6,4"
                                                                      IsEnabled="{Binding $parent[Window].DataContext.IsRunning, Converter={StaticResource BoolToInverseConverter}}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTemplateColumn Header="操作" Width="1.2*" CanUserSort="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button Classes="modern-danger" 
                                                                    Content="删除" 
                                                                    FontSize="12"
                                                                    Padding="8,4"
                                                                    Command="{Binding $parent[Window].DataContext.DeleteCommunityCommand}"
                                                                    CommandParameter="{Binding}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    
                                    <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,2,0,0">
                                        <Border Classes="info-icon"
                                                Width="24" Height="24" 
                                                VerticalAlignment="Center">
                                            <TextBlock Text="i"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontWeight="Bold"
                                                       FontSize="14"
                                                       Foreground="White"/>
                                        </Border>
                                        <TextBlock Text="小区为必填，层数可以范围选择，例如2-4,6(注意要英文逗号)，层数不填即不筛选，其他如果填0则默认为不筛选"
                                                   Foreground="{DynamicResource ThemeTextSecondary}"
                                                   FontSize="12"
                                                   TextWrapping="Wrap"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>

                                    <!-- 缓存的房源映射显示区域 -->
                                    <StackPanel Spacing="16" Margin="0,24,0,0">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <Border Classes="success-icon"
                                                    Width="24" Height="24" 
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="💾"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           FontSize="12"
                                                           Foreground="White"/>
                                            </Border>
                                            <TextBlock Classes="modern-label" 
                                                       Text="缓存的房源映射" 
                                                       FontSize="16" 
                                                       FontWeight="SemiBold"/>
                                                                                             <TextBlock Text="{Binding RoomIdMappings.Count, Converter={StaticResource ConditionCountConverter}}"
                                                            Foreground="{DynamicResource ThemeTextSecondary}"
                                                            FontSize="12"
                                                            VerticalAlignment="Center"/>
                                        </StackPanel>

                                                                                    <ItemsControl ItemsSource="{Binding RoomIdMappings}" 
                                                          IsVisible="{Binding RoomIdMappings.Count, Converter={StaticResource IntGreaterThanZeroConverter}}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Classes="modern-card" 
                                                            Background="{DynamicResource ThemeTableAlternating}"
                                                            CornerRadius="12" 
                                                            Padding="16" 
                                                            Margin="0,0,0,8">
                                                        <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
                                                            <!-- 条件信息摘要 -->
                                                            <StackPanel Grid.Row="0" Grid.Column="0" Spacing="8">
                                                                <StackPanel Orientation="Horizontal" Spacing="16">
                                                                    <TextBlock Text="{Binding CommunityName}" 
                                                                               FontWeight="SemiBold" 
                                                                               FontSize="14"
                                                                               Foreground="{DynamicResource ThemeTextPrimary}"/>
                                                                                                                                         <TextBlock Text="{Binding HouseType, Converter={StaticResource HouseTypeConverter}}"
                                                                                FontSize="12"
                                                                                Foreground="{DynamicResource ThemeTextSecondary}"/>
                                                                                                                                                                                                              <TextBlock Text="{Binding FloorRange, Converter={StaticResource FloorRangeConverter}}"
                                                                                FontSize="12"
                                                                                Foreground="{DynamicResource ThemeTextSecondary}"/>
                                                                </StackPanel>
                                                                <StackPanel Orientation="Horizontal" Spacing="16">
                                                                    <TextBlock Text="{Binding LastUpdated, Converter={StaticResource UpdateTimeConverter}}"
                                                                               FontSize="11"
                                                                               Foreground="{DynamicResource ThemeTextSecondary}"/>
                                                                </StackPanel>
                                                            </StackPanel>

                                                            <!-- 房源数量和展开按钮 -->
                                                            <StackPanel Grid.Row="0" Grid.Column="1" 
                                                                        Orientation="Horizontal" 
                                                                        Spacing="8" 
                                                                        VerticalAlignment="Center">
                                                                <Border Background="{DynamicResource ThemeAccent}" 
                                                                        CornerRadius="12" 
                                                                        Padding="8,4">
                                                                    <TextBlock Text="{Binding RoomIds.Count, Converter={StaticResource RoomCountConverter}}" 
                                                                               FontSize="11" 
                                                                               FontWeight="SemiBold"
                                                                               Foreground="White"/>
                                                                </Border>
                                                                                                                                 <ToggleButton Name="ExpandButton"
                                                                               Background="Transparent"
                                                                               BorderThickness="0"
                                                                               Padding="4"
                                                                               FontSize="10"
                                                                               Foreground="{DynamicResource ThemeTextSecondary}"
                                                                               IsVisible="{Binding RoomIds.Count, Converter={StaticResource IntGreaterThanZeroConverter}}">
                                                                     <ToggleButton.Content>
                                                                         <TextBlock Text="▶" Name="ExpandIcon"/>
                                                                     </ToggleButton.Content>
                                                                     <ToggleButton.Styles>
                                                                         <Style Selector="ToggleButton:checked TextBlock">
                                                                             <Setter Property="Text" Value="▼"/>
                                                                         </Style>
                                                                     </ToggleButton.Styles>
                                                                 </ToggleButton>
                                                            </StackPanel>

                                                            <!-- 房源ID列表（可折叠） -->
                                                            <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                                                    IsVisible="{Binding #ExpandButton.IsChecked}"
                                                                    Background="{DynamicResource ThemeCardBackground}"
                                                                    CornerRadius="8"
                                                                    Padding="12"
                                                                    Margin="0,12,0,0">
                                                                <ScrollViewer MaxHeight="200" 
                                                                              VerticalScrollBarVisibility="Auto"
                                                                              HorizontalScrollBarVisibility="Disabled">
                                                                    <ItemsControl ItemsSource="{Binding RoomIds}">
                                                                        <ItemsControl.ItemsPanel>
                                                                            <ItemsPanelTemplate>
                                                                                <UniformGrid Columns="2"/>
                                                                            </ItemsPanelTemplate>
                                                                        </ItemsControl.ItemsPanel>
                                                                        <ItemsControl.ItemTemplate>
                                                                            <DataTemplate>
                                                                                <Border Background="{DynamicResource ThemeTableHover}"
                                                                                        CornerRadius="6"
                                                                                        Padding="8,4"
                                                                                        Margin="2">
                                                                                    <TextBlock Text="{Binding}" 
                                                                                               FontFamily="Consolas, monospace"
                                                                                               FontSize="10"
                                                                                               Foreground="{DynamicResource ThemeTextSecondary}"
                                                                                               TextTrimming="CharacterEllipsis"
                                                                                               ToolTip.Tip="{Binding}"/>
                                                                                </Border>
                                                                            </DataTemplate>
                                                                        </ItemsControl.ItemTemplate>
                                                                    </ItemsControl>
                                                                </ScrollViewer>
                                                            </Border>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>

                                        <!-- 空状态提示 -->
                                        <Border Classes="modern-card"
                                                Background="{DynamicResource ThemeTableAlternating}"
                                                CornerRadius="12"
                                                Padding="20"
                                                IsVisible="{Binding RoomIdMappings.Count, Converter={StaticResource BoolToInverseConverter}}">
                                            <StackPanel Spacing="8" HorizontalAlignment="Center">
                                                <TextBlock Text="📭" 
                                                           FontSize="32" 
                                                           HorizontalAlignment="Center"
                                                           Opacity="0.6"/>
                                                <TextBlock Text="暂无缓存的房源映射" 
                                                           FontSize="14"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource ThemeTextSecondary}"
                                                           HorizontalAlignment="Center"/>
                                                <TextBlock Text="点击『获取房间ID』按钮来预获取房源" 
                                                           FontSize="12"
                                                           Foreground="{DynamicResource ThemeTextSecondary}"
                                                           HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                                
                                <!-- 手动房源ID输入内容 -->
                                <StackPanel IsVisible="{Binding UseManualRoomIds}" Spacing="16">
                                    <StackPanel Spacing="8">
                                        <TextBlock Classes="modern-label" Text="房源ID列表（每行一个或用逗号分隔）"/>
                                        <TextBox Text="{Binding ManualRoomIds}"
                                                 IsEnabled="{Binding !IsRunning}"
                                                 AcceptsReturn="True"
                                                 TextWrapping="Wrap"
                                                 MinHeight="120"
                                                 MaxHeight="300"
                                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                 Watermark="例如：6b9cc3b2-ea56-490d-aad1-a9d70101e32f"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <Border Classes="warning-icon"
                                                Width="24" Height="24" 
                                                VerticalAlignment="Center">
                                            <TextBlock Text="!"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontWeight="Bold"
                                                       FontSize="14"
                                                       Foreground="White"/>
                                        </Border>
                                        <TextBlock Text="使用手动房源ID时，将忽略社区条件设置和预获取的房间ID。请确保ID格式正确。"
                                                   Foreground="{DynamicResource ThemeWarning}"
                                                   FontSize="12"
                                                   TextWrapping="Wrap"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>


                </StackPanel>
                
                <!-- 双列布局 (窗口宽度 >= 断点) -->
                <Grid x:Name="DoubleColumnLayout" 
                      IsVisible="False"
                      HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="500"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- 左侧配置面板 -->
                    <StackPanel Grid.Column="0" Spacing="0">

                        <!-- 运行模式配置 -->
                        <Border Classes="collapsible-card">
                            <Grid RowDefinitions="Auto,Auto">
                                <Button Grid.Row="0" 
                                        Classes="collapse-header"
                                        Click="OnOperationModeToggle"
                                        x:Name="OperationModeToggle">
                                    <StackPanel Orientation="Horizontal" Spacing="16">
                                        <TextBlock Text="🚀" FontSize="20" VerticalAlignment="Center"/>
                                        <TextBlock Text="运行模式配置" VerticalAlignment="Center"/>
                                        <TextBlock Text="▼" 
                                                   x:Name="OperationModeIcon"
                                                   FontSize="14" 
                                                   VerticalAlignment="Center" 
                                                   Foreground="{DynamicResource ThemeTextSecondary}"/>
                                    </StackPanel>
                                </Button>

                                <StackPanel Grid.Row="1" 
                                            x:Name="OperationModeContent"
                                            Spacing="20" 
                                            Margin="24,0,24,24">
                                    <StackPanel Orientation="Horizontal" Spacing="24">
                                        <StackPanel Spacing="8">
                                            <TextBlock Classes="modern-label" Text="运行模式"/>
                                            <ComboBox Width="240" 
                                                      SelectedIndex="{Binding SelectedOperationMode}"
                                                      ItemsSource="{Binding OperationModes}"
                                                      IsEnabled="{Binding !IsRunning}"
                                                      ToolTip.Tip="模拟点击模式可以看到具体的操作，在最后一步确认需要手动点击，成功率较高，但是速度较发包模式慢；发包模式理论速度最快，但是需要cookie，并且不保证成功率"/>
                                        </StackPanel>

                                        <StackPanel Spacing="8">
                                            <TextBlock Classes="modern-label" Text="浏览器类型"/>
                                            <ComboBox Width="180" 
                                                      SelectedIndex="{Binding SelectedBrowserType}"
                                                      ItemsSource="{Binding BrowserTypes}"
                                                      IsEnabled="{Binding !IsRunning}"/>
                                        </StackPanel>

                                        <Border Classes="info-icon"
                                                Width="40" Height="40" 
                                                VerticalAlignment="Bottom"
                                                Margin="12,0,0,0"
                                                ToolTip.Tip="模拟点击模式可以看到具体的操作，在最后一步确认需要手动点击，成功率较高，但是速度较发包模式慢；发包模式理论速度最快，但是需要cookie，并且不保证成功率">
                                            <TextBlock Text="?"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontWeight="Bold"
                                                       FontSize="20"
                                                       Foreground="White"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- 账户信息配置 -->
                        <Border Classes="collapsible-card">
                            <Grid RowDefinitions="Auto,Auto">
                                <Button Grid.Row="0" 
                                        Classes="collapse-header"
                                        Click="OnAccountToggle"
                                        x:Name="AccountToggle">
                                    <StackPanel Orientation="Horizontal" Spacing="16">
                                        <TextBlock Text="👤" FontSize="20" VerticalAlignment="Center"/>
                                        <TextBlock Text="账户信息配置" VerticalAlignment="Center"/>
                                        <TextBlock Text="▶" 
                                                   x:Name="AccountIcon"
                                                   FontSize="14" 
                                                   VerticalAlignment="Center" 
                                                   Foreground="{DynamicResource ThemeTextSecondary}"/>
                                    </StackPanel>
                                </Button>

                                <StackPanel Grid.Row="1" 
                                            x:Name="AccountContent"
                                            Spacing="20" 
                                            Margin="24,0,24,24"
                                            IsVisible="False">
                                    <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="160,*,Auto">
                                        <!-- 用户账号 -->
                                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                                   Classes="modern-label"
                                                   Text="用户账号"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,24,0"/>
                                        <TextBox Grid.Row="0" Grid.Column="1" 
                                                 Text="{Binding UserAccount}"
                                                 IsEnabled="{Binding !IsRunning}"
                                                 Watermark="请输入用户账号"
                                                 Margin="0,0,24,16"/>

                                        <!-- 用户密码 -->
                                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                                   Classes="modern-label"
                                                   Text="用户密码"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,24,0"/>
                                        <TextBox Grid.Row="1" Grid.Column="1" 
                                                 Text="{Binding UserPassword}"
                                                 IsEnabled="{Binding !IsRunning}"
                                                 PasswordChar="●"
                                                 Watermark="请输入用户密码"
                                                 Margin="0,0,24,16"/>

                                        <!-- Cookie -->
                                        <TextBlock Grid.Row="2" Grid.Column="0" 
                                                   Classes="modern-label"
                                                   Text="Cookie"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,24,0"/>
                                        <Grid Grid.Row="2" Grid.Column="1" 
                                              ColumnDefinitions="200,Auto"
                                              Margin="0,0,24,16">
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding Cookie}"
                                                     IsEnabled="{Binding !IsRunning}"
                                                     Watermark="请输入Cookie(Http发包模式必填)"
                                                     Margin="0,0,8,0"/>
                                            <Button Grid.Column="1"
                                                    Classes="modern-secondary" 
                                                    Content="{Binding IsFetchingCookie, Converter={StaticResource FetchingCookieTextConverter}}" 
                                                    Command="{Binding FetchCookieCommand}"
                                                    FontSize="12"
                                                    Padding="6,4"
                                                    ToolTip.Tip="通过用户名和密码自动获取Cookie">
                                                <Button.IsEnabled>
                                                    <MultiBinding Converter="{StaticResource MultiBoolConverter}">
                                                        <Binding Path="!IsRunning"/>
                                                        <Binding Path="!IsFetchingCookie"/>
                                                    </MultiBinding>
                                                </Button.IsEnabled>
                                            </Button>
                                        </Grid>
                                        <Border Grid.Row="2" Grid.Column="2" 
                                                Classes="warning-icon"
                                                Width="36" Height="36" 
                                                VerticalAlignment="Center"
                                                ToolTip.Tip="填写了cookie后就不用填账号密码了。点击『自动获取』按钮可以通过账号密码自动获取Cookie">
                                            <TextBlock Text="?"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontWeight="Bold"
                                                       FontSize="18"
                                                       Foreground="White"/>
                                        </Border>

                                        <!-- 申请人姓名 -->
                                        <TextBlock Grid.Row="3" Grid.Column="0" 
                                                   Classes="modern-label"
                                                   Text="申请人姓名"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,24,0"/>
                                        <TextBox Grid.Row="3" Grid.Column="1" 
                                                 Text="{Binding ApplierName}"
                                                 IsEnabled="{Binding !IsRunning}"
                                                 Watermark="请输入申请人姓名"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- 执行参数配置 -->
                        <Border Classes="collapsible-card">
                            <Grid RowDefinitions="Auto,Auto">
                                <Button Grid.Row="0" 
                                        Classes="collapse-header"
                                        Click="OnExecutionToggle"
                                        x:Name="ExecutionToggle">
                                    <StackPanel Orientation="Horizontal" Spacing="16">
                                        <TextBlock Text="⏰" FontSize="20" VerticalAlignment="Center"/>
                                        <TextBlock Text="执行参数配置" VerticalAlignment="Center"/>
                                        <TextBlock Text="▶" 
                                                   x:Name="ExecutionIcon"
                                                   FontSize="14" 
                                                   VerticalAlignment="Center" 
                                                   Foreground="{DynamicResource ThemeTextSecondary}"/>
                                    </StackPanel>
                                </Button>

                                <StackPanel Grid.Row="1" 
                                            x:Name="ExecutionContent"
                                            Spacing="16" 
                                            Margin="24,0,24,24"
                                            IsVisible="False">
                                    <!-- 开始时间 -->
                                    <StackPanel Spacing="8">
                                        <TextBlock Classes="modern-label" Text="开始时间"/>
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <CalendarDatePicker SelectedDate="{Binding StartDate}" Width="160" IsEnabled="{Binding !IsRunning}"/>
                                            <TextBox Text="{Binding StartHour}" Width="60" Watermark="时" IsEnabled="{Binding !IsRunning}"/>
                                            <TextBlock Text=":" VerticalAlignment="Center" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource ThemeTextPrimary}"/>
                                            <TextBox Text="{Binding StartMinute}" Width="60" Watermark="分" IsEnabled="{Binding !IsRunning}"/>
                                            <TextBlock Text=":" VerticalAlignment="Center" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource ThemeTextPrimary}"/>
                                            <TextBox Text="{Binding StartSecond}" Width="60" Watermark="秒" IsEnabled="{Binding !IsRunning}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- 触发间隔 -->
                                    <StackPanel Spacing="8">
                                        <TextBlock Classes="modern-label" Text="触发间隔(ms)"/>
                                        <TextBox Text="{Binding ClickInterval}" 
                                                 Width="140"
                                                 HorizontalAlignment="Left"
                                                 IsEnabled="{Binding !IsRunning}"/>
                                    </StackPanel>

                                    <!-- 自动确认 -->
                                    <StackPanel Spacing="8">
                                        <TextBlock Classes="modern-label" Text="自动确定最后一步"/>
                                        <StackPanel Orientation="Horizontal" Spacing="16">
                                            <CheckBox IsChecked="{Binding AutoConfirm}"
                                                      IsEnabled="{Binding !IsRunning}"
                                                      VerticalAlignment="Center"/>
                                            <Border Classes="danger-icon"
                                                    Width="32" Height="32" 
                                                    VerticalAlignment="Center"
                                                    ToolTip.Tip="慎重选择！如果选中，程序会自动点击最后一步抢房，如果不选中，程序会停在最后一步，需要手动点击确认">
                                                <TextBlock Text="!"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           FontWeight="Bold"
                                                           FontSize="18"
                                                           Foreground="White"/>
                                            </Border>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                    
                    <!-- 右侧房源设置面板 -->
                    <Border Grid.Column="2" Classes="collapsible-card">
                        <Grid RowDefinitions="Auto,Auto">
                            <!-- 面板标题行 -->
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Button Grid.Column="0" 
                                        Classes="collapse-header"
                                        Click="OnCommunityToggle"
                                        x:Name="CommunityToggle"
                                        HorizontalAlignment="Stretch">
                                    <StackPanel Orientation="Horizontal" Spacing="16">
                                        <TextBlock Text="🏘️" FontSize="20" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding UseManualRoomIds, Converter={StaticResource BoolToTextConverter}}" VerticalAlignment="Center"/>
                                        <Border Classes="success-icon"
                                                Width="28" Height="28" 
                                                VerticalAlignment="Center"
                                                Margin="12,0,0,0"
                                                ToolTip.Tip="配置房源选择条件">
                                            <TextBlock Text="?"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontWeight="Bold"
                                                       FontSize="14"
                                                       Foreground="White"/>
                                        </Border>
                                        <TextBlock Text="▶" 
                                                   x:Name="CommunityIcon"
                                                   FontSize="14" 
                                                   VerticalAlignment="Center" 
                                                   Foreground="{DynamicResource ThemeTextSecondary}"/>
                                    </StackPanel>
                                </Button>
                                
                                <!-- 切换开关放在最右边 -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Margin="12,0">
                                    <TextBlock Text="社区条件" FontSize="11" VerticalAlignment="Center" Foreground="{DynamicResource ThemeTextSecondary}"/>
                                    <ToggleSwitch IsChecked="{Binding UseManualRoomIds}" 
                                                  IsEnabled="{Binding !IsRunning}"
                                                  OffContent=""
                                                  OnContent=""
                                                  ToolTip.Tip="切换房源设置模式：关闭=社区条件设置，开启=手动房源ID"/>
                                    <TextBlock Text="手动ID" FontSize="11" VerticalAlignment="Center" Foreground="{DynamicResource ThemeTextSecondary}"/>
                                </StackPanel>
                            </Grid>

                                <StackPanel Grid.Row="1" 
                                            x:Name="CommunityContent"
                                            Spacing="20" 
                                            Margin="24,0,24,24"
                                            IsVisible="False">
                                    
                                    <!-- 社区条件设置内容 -->
                                    <StackPanel IsVisible="{Binding !UseManualRoomIds}">
                                        <Button Classes="modern-primary" 
                                                Content="➕ 添加条件" 
                                                Command="{Binding AddCommunityCommand}" 
                                                IsEnabled="{Binding !IsRunning}"
                                                HorizontalAlignment="Left"/>

                                        <!-- 双列布局DataGrid -->
                                        <DataGrid Classes="modern"
                                                  ItemsSource="{Binding CommunityConditions}"
                                                  CanUserReorderColumns="False"
                                                  CanUserResizeColumns="False"
                                                  CanUserSortColumns="False"
                                                  GridLinesVisibility="None"
                                                  HeadersVisibility="Column"
                                                  MinHeight="100"
                                                  Background="Transparent"
                                                  BorderThickness="0"
                                                  CornerRadius="12"
                                                  AutoGenerateColumns="False"
                                                  IsEnabled="{Binding !IsRunning}"
                                                  Margin="0,8"
                                                  HorizontalAlignment="Stretch">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="小区名称" Binding="{Binding CommunityName}" Width="2*" CanUserSort="False"/>
                                                <DataGridTextColumn Header="幢号" Binding="{Binding BuildingNo}" Width="0.8*" CanUserSort="False"/>
                                                <DataGridTextColumn Header="层数" Binding="{Binding FloorRange}" Width="1*" CanUserSort="False"/>
                                                <DataGridTextColumn Header="价格" Binding="{Binding MaxPrice}" Width="1*" CanUserSort="False"/>
                                                <DataGridTextColumn Header="面积" Binding="{Binding LeastArea}" Width="1*" CanUserSort="False"/>
                                                <DataGridTemplateColumn Header="房型" Width="1*" CanUserSort="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <ComboBox SelectedItem="{Binding HouseTypeDescription}"
                                                                      ItemsSource="{Binding $parent[Window].DataContext.HouseTypes}"
                                                                      HorizontalAlignment="Stretch"
                                                                      Margin="4,2"
                                                                      FontSize="12"
                                                                      BorderThickness="1"
                                                                      Padding="6,4"
                                                                      IsEnabled="{Binding $parent[Window].DataContext.IsRunning, Converter={StaticResource BoolToInverseConverter}}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTemplateColumn Header="操作" Width="1*" CanUserSort="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button Classes="modern-danger" 
                                                                    Content="删除" 
                                                                    FontSize="12"
                                                                    Padding="8,4"
                                                                    Command="{Binding $parent[Window].DataContext.DeleteCommunityCommand}"
                                                                    CommandParameter="{Binding}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                        
                                        <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,2,0,0">
                                            <Border Classes="info-icon"
                                                    Width="24" Height="24" 
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="i"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           FontWeight="Bold"
                                                           FontSize="14"
                                                           Foreground="White"/>
                                            </Border>
                                            <TextBlock Text="小区为必填，层数可以范围选择，例如2-4,6(注意要英文逗号)，层数不填即不筛选，其他如果填0则默认为不筛选"
                                                       Foreground="{DynamicResource ThemeTextSecondary}"
                                                       FontSize="12"
                                                       TextWrapping="Wrap"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>

                                        <!-- 缓存的房源映射显示区域 -->
                                        <StackPanel Spacing="16" Margin="0,24,0,0">
                                            <StackPanel Orientation="Horizontal" Spacing="12">
                                                <Border Classes="success-icon"
                                                        Width="24" Height="24" 
                                                        VerticalAlignment="Center">
                                                    <TextBlock Text="💾"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"
                                                               FontSize="12"
                                                               Foreground="White"/>
                                                </Border>
                                                <TextBlock Classes="modern-label" 
                                                           Text="缓存的房源映射" 
                                                           FontSize="16" 
                                                           FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding RoomIdMappings.Count, Converter={StaticResource ConditionCountConverter}}"
                                                           Foreground="{DynamicResource ThemeTextSecondary}"
                                                           FontSize="12"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <ItemsControl ItemsSource="{Binding RoomIdMappings}" 
                                                          IsVisible="{Binding RoomIdMappings.Count, Converter={StaticResource IntGreaterThanZeroConverter}}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Classes="modern-card" 
                                                                Background="{DynamicResource ThemeTableAlternating}"
                                                                CornerRadius="12" 
                                                                Padding="16" 
                                                                Margin="0,0,0,8">
                                                            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
                                                                <!-- 条件信息摘要 -->
                                                                <StackPanel Grid.Row="0" Grid.Column="0" Spacing="8">
                                                                    <StackPanel Orientation="Horizontal" Spacing="16">
                                                                        <TextBlock Text="{Binding CommunityName}" 
                                                                                   FontWeight="SemiBold" 
                                                                                   FontSize="14"
                                                                                   Foreground="{DynamicResource ThemeTextPrimary}"/>
                                                                                                                                                 <TextBlock Text="{Binding HouseType, Converter={StaticResource HouseTypeConverter}}"
                                                                                    FontSize="12"
                                                                                    Foreground="{DynamicResource ThemeTextSecondary}"/>
                                                                                                                                             <TextBlock Text="{Binding FloorRange, Converter={StaticResource FloorRangeConverter}}"
                                                                                FontSize="12"
                                                                                Foreground="{DynamicResource ThemeTextSecondary}"/>
                                                                    </StackPanel>
                                                                    <StackPanel Orientation="Horizontal" Spacing="16">
                                                                        <TextBlock Text="{Binding LastUpdated, Converter={StaticResource UpdateTimeConverter}}"
                                                                                   FontSize="11"
                                                                                   Foreground="{DynamicResource ThemeTextSecondary}"/>
                                                                    </StackPanel>
                                                                </StackPanel>

                                                                <!-- 房源数量和展开按钮 -->
                                                                <StackPanel Grid.Row="0" Grid.Column="1" 
                                                                            Orientation="Horizontal" 
                                                                            Spacing="8" 
                                                                            VerticalAlignment="Center">
                                                                    <Border Background="{DynamicResource ThemeAccent}" 
                                                                            CornerRadius="12" 
                                                                            Padding="8,4">
                                                                        <TextBlock Text="{Binding RoomIds.Count, Converter={StaticResource RoomCountConverter}}" 
                                                                                   FontSize="11" 
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="White"/>
                                                                    </Border>
                                                                                                                                     <ToggleButton Name="ExpandButton"
                                                                               Background="Transparent"
                                                                               BorderThickness="0"
                                                                               Padding="4"
                                                                               FontSize="10"
                                                                               Foreground="{DynamicResource ThemeTextSecondary}"
                                                                               IsVisible="{Binding RoomIds.Count, Converter={StaticResource IntGreaterThanZeroConverter}}">
                                                                     <ToggleButton.Content>
                                                                         <TextBlock Text="▶" Name="ExpandIcon"/>
                                                                     </ToggleButton.Content>
                                                                     <ToggleButton.Styles>
                                                                         <Style Selector="ToggleButton:checked TextBlock">
                                                                             <Setter Property="Text" Value="▼"/>
                                                                         </Style>
                                                                     </ToggleButton.Styles>
                                                                 </ToggleButton>
                                                                </StackPanel>

                                                                <!-- 房源ID列表（可折叠） -->
                                                                <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                                                        IsVisible="{Binding #ExpandButton.IsChecked}"
                                                                        Background="{DynamicResource ThemeCardBackground}"
                                                                        CornerRadius="8"
                                                                        Padding="12"
                                                                        Margin="0,12,0,0">
                                                                    <ScrollViewer MaxHeight="200" 
                                                                                  VerticalScrollBarVisibility="Auto"
                                                                                  HorizontalScrollBarVisibility="Disabled">
                                                                        <ItemsControl ItemsSource="{Binding RoomIds}">
                                                                            <ItemsControl.ItemsPanel>
                                                                                <ItemsPanelTemplate>
                                                                                    <UniformGrid Columns="2"/>
                                                                                </ItemsPanelTemplate>
                                                                            </ItemsControl.ItemsPanel>
                                                                            <ItemsControl.ItemTemplate>
                                                                                <DataTemplate>
                                                                                    <Border Background="{DynamicResource ThemeTableHover}"
                                                                                            CornerRadius="6"
                                                                                            Padding="8,4"
                                                                                            Margin="2">
                                                                                        <TextBlock Text="{Binding}" 
                                                                                                   FontFamily="Consolas, monospace"
                                                                                                   FontSize="10"
                                                                                                   Foreground="{DynamicResource ThemeTextSecondary}"
                                                                                                   TextTrimming="CharacterEllipsis"
                                                                                                   ToolTip.Tip="{Binding}"/>
                                                                                    </Border>
                                                                                </DataTemplate>
                                                                            </ItemsControl.ItemTemplate>
                                                                        </ItemsControl>
                                                                    </ScrollViewer>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>

                                            <!-- 空状态提示 -->
                                            <Border Classes="modern-card"
                                                    Background="{DynamicResource ThemeTableAlternating}"
                                                    CornerRadius="12"
                                                    Padding="20"
                                                    IsVisible="{Binding RoomIdMappings.Count, Converter={StaticResource BoolToInverseConverter}}">
                                                <StackPanel Spacing="8" HorizontalAlignment="Center">
                                                    <TextBlock Text="📭" 
                                                               FontSize="32" 
                                                               HorizontalAlignment="Center"
                                                               Opacity="0.6"/>
                                                    <TextBlock Text="暂无缓存的房源映射" 
                                                               FontSize="14"
                                                               FontWeight="SemiBold"
                                                               Foreground="{DynamicResource ThemeTextSecondary}"
                                                               HorizontalAlignment="Center"/>
                                                                                                     <TextBlock Text="点击『获取房间ID』按钮来预获取房源" 
                                                            FontSize="12"
                                                            Foreground="{DynamicResource ThemeTextSecondary}"
                                                            HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <!-- 手动房源ID输入内容 -->
                                    <StackPanel IsVisible="{Binding UseManualRoomIds}" Spacing="16">
                                        <StackPanel Spacing="8">
                                            <TextBlock Classes="modern-label" Text="房源ID列表（每行一个或用逗号分隔）"/>
                                            <TextBox Text="{Binding ManualRoomIds}"
                                                     IsEnabled="{Binding !IsRunning}"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     MinHeight="120"
                                                     MaxHeight="300"
                                                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                     Watermark="例如：6b9cc3b2-ea56-490d-aad1-a9d70101e32f"
                                                     HorizontalAlignment="Stretch"/>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <Border Classes="warning-icon"
                                                    Width="24" Height="24" 
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="!"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           FontWeight="Bold"
                                                           FontSize="14"
                                                           Foreground="White"/>
                                            </Border>
                                            <TextBlock Text="使用手动房源ID时，将忽略社区条件设置和预获取的房间ID。请确保ID格式正确。"
                                                       Foreground="{DynamicResource ThemeWarning}"
                                                       FontSize="12"
                                                       TextWrapping="Wrap"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                </Grid>
            </Panel>
        </ScrollViewer>

        <!-- 固定的日志输出区域 - 可手动拖拽调整高度 -->
        <Border Grid.Row="2" 
                Classes="modern-card"
                Margin="12,12,12,0"
                x:Name="LogArea"
                Height="180"
                MinHeight="80"
                MaxHeight="400">
            <Grid RowDefinitions="Auto,Auto,*">
                <!-- 拖拽手柄区域 -->
                <Border Grid.Row="0" 
                        Height="8" 
                        Background="Transparent"
                        Cursor="SizeNorthSouth"
                        x:Name="ResizeHandle">
                    <Border Height="3" 
                            Background="{DynamicResource ThemeBorder}" 
                            CornerRadius="2" 
                            Margin="40,0"
                            Opacity="0.6"/>
                </Border>
                
                <!-- 标题区域 -->
                <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" Margin="0,8,0,16">
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
                        <TextBlock Text="📋" FontSize="20" VerticalAlignment="Center"/>
                        <TextBlock Classes="modern-title" Text="日志输出" FontSize="22"/>
                    </StackPanel>
                    
                    <!-- 状态指示器 -->
                    <StackPanel Grid.Column="2" 
                               Orientation="Horizontal" 
                               Spacing="12" 
                               VerticalAlignment="Center"
                               x:Name="StatusIndicatorPanel">
                        
                        <!-- 运行状态指示灯 -->
                        <Border CornerRadius="8" 
                               Padding="8,4" 
                               Background="{DynamicResource ThemeTableAlternating}"
                               x:Name="RunningStatusBorder">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Ellipse Width="8" Height="8" 
                                        Fill="{DynamicResource ThemeTextSecondary}" 
                                        x:Name="StatusIndicator">
                                    <!-- 默认静态状态 -->
                                </Ellipse>
                                <TextBlock Text="准备就绪" 
                                          FontSize="11" 
                                          Foreground="{DynamicResource ThemeTextSecondary}"
                                          x:Name="StatusText"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- 实时时间显示 -->
                        <Border CornerRadius="8" 
                               Padding="8,4" 
                               Background="{DynamicResource ThemeAccent}">
                            <TextBlock Text="00:00:00" 
                                      FontSize="11" 
                                      Foreground="White"
                                      FontFamily="Consolas, monospace"
                                      x:Name="CurrentTimeText"/>
                        </Border>
                    </StackPanel>
                </Grid>
                
                <!-- 日志内容区域 -->
                <ScrollViewer Grid.Row="2" 
                              VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled"
                              x:Name="LogScrollViewer">
                    <TextBox Classes="modern-log"
                             Text="{Binding LogText}"
                             IsReadOnly="True"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             x:Name="LogTextBox"/>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- 固定的操作按钮区域 - 响应式设计 -->
        <Border Grid.Row="3" 
                BorderBrush="{DynamicResource ThemeBorder}" 
                BorderThickness="0,1,0,0"
                Padding="12,16"
                x:Name="FooterBorder">
            <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                    <GradientStop Color="#FFFFFF" Offset="0"/>
                    <GradientStop Color="#F8F9FA" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid MaxWidth="800" HorizontalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" MaxWidth="180"/>
                    <ColumnDefinition Width="*" MaxWidth="180"/>
                    <ColumnDefinition Width="Auto" MaxWidth="220"/>
                </Grid.ColumnDefinitions>
                
                <Button Grid.Column="0"
                        Classes="modern-primary" 
                        Content="🚀 开始抢房" 
                        Command="{Binding StartProcessCommand}"
                        IsEnabled="{Binding !IsRunning}"
                        Margin="0,0,8,0"
                        FontSize="15"
                        x:Name="StartButton"/>
                
                <Button Grid.Column="1"
                        Classes="modern-secondary" 
                        Content="⏹️ 停止抢房" 
                        Command="{Binding StopProcessCommand}"
                        IsEnabled="{Binding IsRunning}"
                        Margin="8,0,8,0"
                        FontSize="15"/>
                
                <Button Grid.Column="2"
                        Classes="modern-secondary" 
                        Content="🔍 获取房间ID" 
                        Command="{Binding FetchRoomIdsCommand}"
                        Margin="8,0,0,0"
                        FontSize="15"
                        ToolTip.Tip="提前获取所有符合条件的房间ID，加速抢房"
                        x:Name="FetchRoomIdsButton">
                    <Button.IsVisible>
                        <Binding Path="SelectedOperationMode" Converter="{StaticResource IntToBoolConverter}" ConverterParameter="1"/>
                    </Button.IsVisible>
                    <Button.IsEnabled>
                        <MultiBinding Converter="{StaticResource MultiBoolConverter}">
                            <Binding Path="!IsRunning"/>
                            <Binding Path="!IsFetchingRoomIds"/>
                        </MultiBinding>
                    </Button.IsEnabled>
                </Button>
            </Grid>
        </Border>

    </Grid>

</Window>
